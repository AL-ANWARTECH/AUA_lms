{% extends 'base.html' %}

{% block title %}Create Account - AUA LMS{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6 col-xl-5">
            
            <div class="text-center mb-4">
                <h3 class="fw-bold text-primary">Create Your Account</h3>
                <p class="text-muted">Join our learning community today.</p>
            </div>

            <div class="card border-0 shadow-sm rounded-3">
                <div class="card-body p-4 p-md-5">
                    
                    <form method="post" enctype="multipart/form-data" novalidate>
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <label for="{{ form.role.id_for_label }}" class="form-label fw-bold small text-muted text-uppercase">
                                I want to join as a...
                            </label>
                            {{ form.role }}
                            {% if form.role.errors %}
                                <div class="text-danger small mt-1">{{ form.role.errors }}</div>
                            {% endif %}
                        </div>

                        <hr class="my-4 text-muted opacity-25">

                        {% for field in form %}
                            {% if field.name != 'role' %} <div class="mb-3 field-wrapper" id="div_id_{{ field.name }}">
                                    <label for="{{ field.id_for_label }}" class="form-label fw-bold small text-secondary">
                                        {{ field.label }}
                                    </label>
                                    
                                    {{ field }}
                                    
                                    {% if field.help_text %}
                                        <div class="form-text small text-muted">{{ field.help_text }}</div>
                                    {% endif %}
                                    
                                    {% for error in field.errors %}
                                        <div class="text-danger small mt-1">
                                            <i class="bi bi-exclamation-circle me-1"></i>{{ error }}
                                        </div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        {% endfor %}

                        <div class="form-check mb-4 mt-4">
                            <input class="form-check-input" type="checkbox" id="termsCheck" required>
                            <label class="form-check-label small text-muted" for="termsCheck">
                                I agree to the <a href="#" class="text-decoration-none">Terms of Service</a> and Privacy Policy.
                            </label>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-sm">
                                Register Now
                            </button>
                        </div>

                    </form>

                    <div class="text-center mt-4 pt-3 border-top">
                        <p class="mb-0 text-muted small">Already have an account?</p>
                        <a href="{% url 'login' %}" class="btn btn-link fw-bold text-decoration-none">Sign In here</a>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        const roleSelect = document.getElementById('roleSelect'); // Ensure forms.py widget has attrs={'id': 'roleSelect'}
        
        // List of fields that should ONLY appear for instructors
        const instructorFieldIds = [
            'div_id_bio', 
            'div_id_portfolio_website', 
            'div_id_identity_document'
        ];

        function toggleInstructorFields() {
            // Get current value (handle if roleSelect is missing or null)
            const role = roleSelect ? roleSelect.value : 'student';
            const isInstructor = (role === 'instructor');

            instructorFieldIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (isInstructor) {
                        element.style.display = 'block'; // Show
                        // Optional: Add logic to make inputs required via JS if needed
                    } else {
                        element.style.display = 'none';  // Hide
                    }
                }
            });
        }

        if (roleSelect) {
            // Run on page load (in case of validation errors returning form)
            toggleInstructorFields();
            
            // Run whenever the user changes the dropdown
            roleSelect.addEventListener('change', toggleInstructorFields);
        }
    });
</script>
{% endblock %}